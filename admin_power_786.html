<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background:#0f172a; color:white; font-family:sans-serif; padding:15px; }
        .card { background:#1e293b; border-radius:12px; padding:15px; margin-bottom:15px; border:1px solid #334155; }
        input, select { width:100%; padding:10px; margin:5px 0; background:#0f172a; border:1px solid #334155; color:white; border-radius:5px; }
        .btn { width:100%; padding:12px; background:#fbbf24; border:none; border-radius:5px; font-weight:bold; cursor:pointer; }
        .w-item { background:#0f172a; padding:10px; border-radius:8px; margin-top:10px; border-left:4px solid #fbbf24; font-size:12px; }
    </style>
</head>
<body>
    <h2 style="color:#fbbf24; text-align:center;">ADMIN MASTER</h2>
    
    <div class="card">
        <h3>Send Reward/Salary</h3>
        <input type="number" id="ph" placeholder="User Number">
        <input type="number" id="am" placeholder="Amount">
        <select id="ty"><option value="SALARY">Salary</option><option value="BONUS">Bonus</option></select>
        <button class="btn" onclick="sendMoney()">Send Now</button>
    </div>

    <div class="card">
        <h3>Withdraw Requests</h3>
        <div id="list">Loading...</div>
    </div>

<script>
    const API = "https://sheetdb.io/api/v1/lcnr1ekbbyn58";

    async function sendMoney() {
        const p = document.getElementById('ph').value;
        const a = document.getElementById('am').value;
        const t = document.getElementById('ty').value;
        const res = await fetch(`${API}/search?number=${p}`);
        const data = await res.json();
        const u = data.find(x => !x.row_type);
        if(u) {
            const nb = parseFloat(u.balance) + parseFloat(a);
            await fetch(`${API}/number/${p}`, { method:'PATCH', headers:{'Content-Type':'application/json'}, body:JSON.stringify({balance:nb}) });
            await fetch(API, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({number:p, row_type:t, w_amount:a, status:'success', date:new Date().toLocaleString()}) });
            Swal.fire("Sent!", "Balance Updated", "success");
        }
    }

    async function loadW() {
        const r = await fetch(`${API}/search?row_type=WITHDRAWAL&status=pending`);
        const d = await r.json();
        // Har withdraw request ke sath user ki binding details bhi fetch karein
        document.getElementById('list').innerHTML = d.map(x => `
            <div class="w-item">
                User: ${x.number} | <b>Rs. ${x.w_amount}</b><br>
                <button onclick="approve('${x.number}','approved')" style="background:#10b981; color:white; border:none; padding:5px; margin-top:5px; border-radius:3px;">Approve</button>
            </div>
        `).join('') || "No Requests";
    }
    window.onload = loadW;
</script>
</body>
</html>
